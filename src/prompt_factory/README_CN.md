# 提示词工厂模块

## 概述

提示词工厂模块是一个专业的提示工程和组装系统，专为AI驱动的代码分析和漏洞检测而设计。它提供了一套全面的专业化提示词集合，针对智能合约审计、区块链分析和多语言代码安全评估进行了优化。

## 核心组件

### Prompt Assembler (`prompt_assembler.py`)
中央提示词组装引擎，组合各种提示词组件：
- **多模式组装**：针对不同扫描模式的不同提示词策略
- **动态组合**：基于上下文的运行时提示词定制
- **模板管理**：高效的提示词模板组织
- **质量优化**：为最大化AI效果而精调的提示词

### 漏洞提示词 (`vul_prompt.py`, `vul_prompt_common.py`, `vul_check_prompt.py`)
专门用于漏洞检测的提示词：
- **智能合约漏洞**：全面覆盖DeFi和区块链特定问题
- **通用模式**：跨语言的通用漏洞模式
- **验证提示词**：专门用于漏洞确认的提示词
- **业务逻辑**：复杂业务流程分析的提示词

### 核心提示词 (`core_prompt.py`)
基础提示词结构：
- **基础模板**：不同分析类型的核心提示词框架
- **角色定义**：AI角色和行为规范
- **任务指令**：清晰精确的任务定义
- **输出格式**：结构化响应格式指南

### 外围提示词 (`periphery_prompt.py`)
支持性提示词组件：
- **上下文设置**：环境和角色建立
- **指导原则**：分析指南和最佳实践
- **安全指令**：提示词注入防护和安全措施
- **语言特定**：针对不同编程语言的定制提示词

### 检查清单提示词 (`checklist_pipeline_prompt.py`, `checklists_prompt.py`)
系统化的清单式分析：
- **流水线集成**：分析流水线中的清单处理
- **全面覆盖**：广泛的安全检查清单模板
- **可定制清单**：用户定义的清单支持
- **进度跟踪**：清单完成情况监控

## 主要特性

### 🎯 专业化提示词工程
- **领域专业知识**：深度理解区块链和智能合约安全
- **多语言支持**：针对Solidity、Rust、Go、C++等优化的提示词
- **上下文感知**：基于代码上下文的动态提示词适配
- **性能优化**：为最大化AI模型效果而工程化

### 🔧 模块化架构
- **组件化设计**：可重用的提示词组件，实现高效组装
- **模板系统**：灵活的模板管理，适用于不同用例
- **配置驱动**：通过配置参数轻松定制
- **可扩展框架**：简单添加新提示词类型和策略

### 🛡️ 安全聚焦设计
- **漏洞覆盖**：全面的漏洞模式覆盖
- **业务逻辑分析**：复杂业务流程分析的专门提示词
- **假阳性减少**：精心制作的提示词以最小化误报
- **验证支持**：多阶段验证提示词策略

### 📊 质量保证
- **提示词验证**：内置的提示词质量验证
- **A/B测试支持**：提示词效果测试框架
- **指标集成**：性能跟踪和优化
- **持续改进**：数据驱动的提示词精化

## 架构设计

```
提示词工厂模块
├── Prompt Assembler (中央引擎)
│   ├── 多模式组装
│   ├── 动态组合
│   └── 模板管理
├── 漏洞提示词
│   ├── 智能合约特定
│   ├── 通用模式
│   └── 验证逻辑
├── 核心提示词
│   ├── 基础模板
│   ├── 角色定义
│   └── 任务指令
├── 外围提示词
│   ├── 上下文设置
│   ├── 指导原则
│   └── 安全指令
└── 检查清单提示词
    ├── 流水线集成
    └── 系统化分析
```

## 提示词类型和模式

### 扫描模式
- **通用模式**：通用漏洞扫描
- **细粒度模式**：特定漏洞焦点的详细分析
- **纯净模式**：无业务上下文的清洁分析
- **检查清单模式**：系统化的清单式分析

### 漏洞类别
- **访问控制**：授权和权限问题
- **重入攻击**：跨函数调用漏洞
- **预言机操纵**：价格源和数据源攻击
- **闪电贷攻击**：MEV和套利漏洞
- **治理攻击**：DAO和投票机制问题
- **跨链桥安全**：跨链协议漏洞

## 使用示例

### 基础提示词组装
```python
from prompt_factory.prompt_assembler import PromptAssembler

# 组装通用漏洞扫描提示词
code = "function transfer(address to, uint256 amount) { ... }"
prompt = PromptAssembler.assemble_prompt_common(code)
```

### 细粒度分析
```python
# 组装特定漏洞焦点的细粒度提示词
prompt_index = 1  # 特定漏洞类型
prompt = PromptAssembler.assemble_prompt_common_fine_grained(code, prompt_index)
```

### 纯净分析模式
```python
# 组装无业务上下文的纯净分析提示词
prompt = PromptAssembler.assemble_prompt_pure(code)
```

### 清单式分析
```python
from prompt_factory.checklist_pipeline_prompt import ChecklistPipelinePrompt

# 生成基于清单的分析提示词
checklist_prompt = ChecklistPipelinePrompt.generate_checklist_prompt(vulnerability_type)
```

## 提示词定制

### 业务类型集成
```python
# 获取特定业务类型的漏洞提示词
business_types = ["defi", "nft", "dao"]
vul_prompts = PromptAssembler._get_vul_prompts(business_types)
```

### 语言特定提示词
```python
# Solidity特定角色设置
role_prompt = PeripheryPrompt.role_set_solidity_common()

# Go特定角色设置
role_prompt = PeripheryPrompt.role_set_go_common()
```

## 配置选项

模块支持通过以下方式进行广泛配置：

- **提示词模板**：不同场景的可定制提示词模板
- **业务类型映射**：不同业务领域的漏洞提示词映射
- **语言设置**：语言特定的提示词适配
- **质量参数**：提示词质量和效果调优

## 集成接口

### 输入来源
- **代码分析**：用于漏洞分析的直接代码输入
- **业务上下文**：业务流程和领域特定信息
- **项目元数据**：项目类型和特征

### 输出消费者
- **AI模型**：OpenAI GPT、Claude和其他语言模型
- **推理模块**：高级推理和分析引擎
- **验证系统**：多阶段验证过程

## 最佳实践

### 提示词工程
- **清晰指令**：精确无歧义的任务定义
- **上下文提供**：充分的上下文以确保准确分析
- **输出结构化**：明确定义的响应格式
- **安全措施**：强大的提示词注入防护

### 性能优化
- **令牌效率**：优化提示词长度以实现成本效益
- **响应质量**：平衡的提示词以获得高质量输出
- **缓存策略**：重复模式的智能提示词缓存
- **版本控制**：系统化的提示词版本管理

## 未来增强

- **AI生成提示词**：机器学习驱动的提示词生成
- **动态适配**：基于性能的实时提示词优化
- **多模态支持**：与代码可视化和分析的集成
- **社区贡献**：社区驱动的提示词改进框架